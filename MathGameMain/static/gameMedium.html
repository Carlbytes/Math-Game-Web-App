<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Game - Medium</title>
    <link rel="stylesheet" href="/main.css">
    <style>
        #orb-container {
            display: flex;
            justify-content: center;
            gap: 1rem; /* Space between orbs */
            margin: 1.5rem 0; /* Space above and below orbs */
            flex-wrap: wrap; /* Allow orbs to wrap on small screens */
        }

        .orb-button {
            min-width: 80px; /* Make orbs a decent size */
            padding: 1rem;
            font-size: 1.2rem; /* Make text inside bigger */
            
            /* Make them rounder */
            border-radius: 50px; 
            
            /* Use the main button styles */
            background-color: #FFD300;
            color: #121b2d;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 8px rgba(255, 211, 0, 0.2);
        }

        .orb-button:hover {
            background-color: #ffdf33;
            box-shadow: 0 4px 12px rgba(255, 211, 0, 0.3);
            transform: translateY(-2px); /* Add a little lift */
        }

        .orb-button:disabled {
            background-color: #5a6a8a; /* Color when disabled */
            color: #9cb3d9;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        /* Style for the correct button after answering */
        .orb-button.correct {
            background-color: #4CAF50; /* Green */
            color: #ffffff;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        /* Style for the wrong button after answering */
        .orb-button.wrong {
            background-color: #d93025; /* Red */
            color: #ffffff;
            box-shadow: 0 2px 8px rgba(217, 48, 37, 0.3);
        }

    </style>
</head>
<body>
    <div class="container" id="game-container">
        <h2>Medium Mode</h2>
        <div id="question">Loading question...</div>
        
      
        <div id="orb-container">
            <!-- Orbs will be dynamically created here by JavaScript -->
        </div>
        
        <div id="message"></div>
        <button onclick="window.location.href='/menu'" style="margin-top: 1rem;">Back to Menu</button>
    </div>

    <script>
        const token = localStorage.getItem('math_game_token');
        if (!token) {
            window.location.href = '/';
        }

        const questionEl = document.getElementById('question');
    
        const orbContainer = document.getElementById('orb-container');
        const messageEl = document.getElementById('message');
        
        let correctAnswer = 0;

        function handleAuthError(response) {
      
            if (response.status === 401) {
                localStorage.removeItem('math_game_token');
                window.location.href = '/';
                return true;
            }
            return false;
        }

        async function getNewQuestion() {
            messageEl.textContent = '';
        
            orbContainer.innerHTML = ''; 
            questionEl.textContent = 'Loading...';

            const res = await fetch('/api/medium/question', {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (handleAuthError(res)) return;

            const data = await res.json();
            questionEl.textContent = data.question;
            correctAnswer = data.answer;

          
            data.orbs.forEach(orbValue => {
                const orbButton = document.createElement('button');
                orbButton.className = 'orb-button';
                orbButton.textContent = orbValue;
                // Store the value in a data attribute
                orbButton.dataset.value = orbValue; 
                // Add the click listener
                orbButton.addEventListener('click', handleOrbClick);
                orbContainer.appendChild(orbButton);
            });
        }

    
        function handleOrbClick(event) {
            // Get the answer from the button's data attribute
            const userAnswer = parseInt(event.target.dataset.value, 10);

            // Disable all orb buttons to prevent multiple clicks
            const orbButtons = document.querySelectorAll('.orb-button');
            orbButtons.forEach(btn => {
                btn.disabled = true;
                // Highlight the correct/wrong buttons
                const btnValue = parseInt(btn.dataset.value, 10);
                if (btnValue === correctAnswer) {
                    btn.classList.add('correct');
                } else if (btnValue === userAnswer) {
                    btn.classList.add('wrong');
                }
            });

            // Call checkAnswer with the chosen value
            checkAnswer(userAnswer);
        }


        async function checkAnswer(userAnswer) {
        

            const res = await fetch('/api/medium/answer', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_answer: userAnswer,
                    correct_answer: correctAnswer
                })
            });

            if (handleAuthError(res)) return;

            const data = await res.json();
            if (data.correct) {
                messageEl.textContent = 'Correct! Loading next question...';
                messageEl.className = 'success';
                setTimeout(getNewQuestion, 1500);
            } else {
                messageEl.textContent = `Incorrect. The answer was ${correctAnswer}. Try this new one.`;
                messageEl.className = 'error';
                setTimeout(getNewQuestion, 2500); // Give more time to see the correct answer
            }
        }

        // Load the first question
        getNewQuestion();
    </script>
</body>
</html>